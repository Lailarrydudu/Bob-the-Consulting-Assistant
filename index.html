<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Consulting Assistant</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Import Georgia (Body) and Roboto Slab (Buttons) */
        @import url('https://fonts.googleapis.com/css2?family=Georgia:wght@400;700&family=Roboto+Slab:wght=700&display=swap');
        
        body {
            /* Main body and response content remains Georgia */
            font-family: 'Georgia', sans-serif;
            background-color: #111827; /* Tailwind gray-900 equivalent */
        }
        
        /* * Main Title: Smaller font, centered, bold. 
         * We'll use this for the H1 tag generated by Markdown's '#' 
         */
        .ai-response-content h1 {
            font-size: 1.8rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 1rem;
        }
        
        /* * Key Sections: Smaller font than the title, bold, no bullet point. 
         * We'll use this for the H2 tag generated by Markdown's '##' 
         */
        .ai-response-content h2 {
            font-size: 1.3rem;
            font-weight: 700;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            color: #bef264 !important;
        }
        
        /* * Sub-sections within a section. 
         * We'll use this for the H3 tag generated by Markdown's '###' 
         */
        .ai-response-content h3 {
            font-size: 1.1rem; /* Slightly smaller for better hierarchy */
            font-weight: 700;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            color: #facc15 !important;
        }
        
        /* * Points in Sections: Bold, smaller than sections, larger than content. 
         * Markdown wraps these in a `<strong>` tag. 
         */
        .ai-response-content strong {
            font-size: 1rem;
            font-weight: 700;
            display: block; 
            margin-bottom: 0.25rem; 
            color: #facc15 !important;
        }
        
        /* Ensure bulleted lists are styled correctly and have a top margin */
        .ai-response-content ul {
            list-style-type: disc;
            padding-left: 2rem;
            margin-top: 0.5rem; /* Reduced margin since the strong tag now has margin-bottom */
        }
        
        /* Add a bottom margin to each list item for more spacing */
        .ai-response-content li {
            margin-bottom: 1.0rem;
        }
        
        /* Basic table styling for clarity */
        .ai-response-content table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
            font-size: 0.9rem;
        }
        
        .ai-response-content th, .ai-response-content td {
            border: 1px solid #d1d5db; /* Lighter border for contrast on dark background */
            padding: 0.75rem;
            text-align: left;
            width: 33%; 
        }
        
        .ai-response-content th {
            /* Darker table header background */
            background-color: #374151; /* Tailwind gray-700 equivalent */
            font-weight: 700;
            color: #f3f4f6;
        }
        
        .ai-response-content td {
            background-color: #1f2937; /* Tailwind gray-800 equivalent */
        }
        .main-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #f3f4f6; /* Tailwind gray-100 equivalent */
        }
        
        .sub-title {
            font-size: 1.125rem;
            color: #d1d5db; /* Tailwind gray-300 equivalent */
            margin-top: 0.25rem;
        }
        
        /* === Custom Button Style (Main Dropdowns) === */
        .prompt-btn, .dropdown-btn {
            /* --- MODIFIED FONT FAMILY, SIZE, AND WEIGHT --- */
            font-family: 'Roboto Slab', serif; 
            font-size: 0.8125rem; 
            font-weight: 700; 
            /* ----------------------------------------------- */
            
            /* Base styles */
            padding-left: 0.75rem;
            padding-right: 0.75rem;
            padding-top: 0.5rem; 
            padding-bottom: 0.5rem; 
            color: #065f46; /* Text-emerald-800 */
            background-color: #ecfdf5; /* Bg-emerald-50 (light emerald) */
            border-radius: 0.75rem; /* Rounded-xl */
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.06); /* Shadow-lg */
            
            /* Border */
            border-width: 2px; 
            border-color: #34d399; /* Tailwind emerald-400 for better visibility */
            
            /* Sizing and alignment */
            width: 11rem; /* w-44 */
            height: 3rem; /* h-12 */
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            white-space: normal;
                        
            /* Hover and transition effects */
            transition: all 0.2s ease-in-out;
            
            /* Ensure dropdown buttons inherit base style but can be overridden */
            cursor: pointer;
        }
        
        .prompt-btn:hover, .dropdown-btn:hover {
            background-color: #d1fae5; /* Hover:bg-emerald-100 */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -4px rgba(0, 0, 0, 0.1); /* Hover:shadow-xl */
            transform: translateY(-2px); /* Subtle lift effect */
        }
        
        /* Added active state for a physical "press" effect */
        .prompt-btn:active, .dropdown-btn:active {
            border-color: #10b981; /* Tailwind emerald-600 */
            border-width: 3px; 
            transform: translateY(0); 
            box-shadow: none; 
        }
        /* === Custom Button Style (Sub-Menu Buttons) === */
        .sub-menu-btn {
            /* Define styles for individual, stacked buttons */
            background-color: #303030; /* Charcoal Grey */
            color: #f3f4f6; /* Tailwind gray-100 */
            width: 100%;
            text-align: left;
            padding: 0.5rem 1rem; /* py-2 px-4 */
            font-size: 0.875rem; /* text-sm */
            transition: all 0.15s ease-in-out;
            font-family: 'Georgia', sans-serif;
            cursor: pointer;
            
            /* Key changes for individual button look */
            border: 1px solid #d1d5db; /* Light Grey (Tailwind gray-300) */
            border-radius: 0.5rem; /* rounded-lg */
            margin-bottom: 0.25rem; /* space between buttons */
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px -1px rgba(0, 0, 0, 0.1);
        }
        
        .sub-menu-btn:hover {
            background-color: #4a4a4a; /* Slightly lighter Charcoal hover */
            transform: scale(1.01);
        }
        /* Ensure the last button doesn't have extra margin at the bottom */
        .sub-menu-btn:last-child {
            margin-bottom: 0;
        }
        /* Custom styles for the dynamic textarea */
        #userInput {
            /* Set initial row size and ensure dynamic growth */
            line-height: 1.5; 
            overflow-y: hidden; /* Hide scrollbar unless max height is reached */
            box-sizing: border-box; /* Include padding and border in the element's total width and height */
            resize: none; /* Prevent manual resizing */
        }
    </style>
    <!-- Add the 'marked' library to handle Markdown-to-HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4 bg-gray-900">
    <!-- Main Container -->
    <div class="bg-gray-800 text-gray-100 rounded-2xl shadow-xl w-full max-w-2xl p-6 md:p-8">
        <!-- Header -->
        <div class="flex items-center space-x-4 mb-6">
            <!-- Updated Circle with a Star SVG -->
            <div class="p-3 bg-emerald-100 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" fill="#10b981" viewBox="0 0 24 24" stroke-width="1.5" stroke="#10b981" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M11.48 3.499a.562.562 0 011.04 0l2.125 5.111a.563.563 0 00.475.345l5.518.442c.499.04.701.663.321.988l-4.225 3.658a.563.563 0 00-.182.557l1.285 5.385a.562.562 0 01-.84.6l-4.725-2.885a.563.563 0 00-.582 0l-4.725 2.885a.562.562 0 01-.84-.6l1.285-5.385a.562.562 0 00-.182-.557L3.991 10.49a.562.562 0 01.32-.988l5.518-.442a.563.563 0 00.475-.345l2.125-5.111z" />
                </svg>
            </div>
            <div>
                <h1 class="main-title">Bob, Your Consulting Assistant</h1>
                <p class="sub-title">You ask. Bob answers.</p>
            </div>
        </div>
        
        <!-- API Key Input -->
        <div id="apiKeyContainer" class="mb-6">
            <label for="apiKeyInput" class="block text-sm font-medium text-gray-100 mb-1">Enter your Gemini API Key:</label>
            <div class="flex items-center space-x-2">
                <input type="password" id="apiKeyInput" class="flex-grow px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500 bg-gray-700 text-white" placeholder="Paste your API key here...">
                <button id="saveKeyButton" class="px-4 py-2 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 disabled:bg-emerald-300 disabled:cursor-not-allowed">
                    Save Key
                </button>
            </div>
        </div>
        
        <!-- Specialized Prompts Buttons (NEW DROPDOWN STRUCTURE) -->
        <div class="flex flex-wrap gap-4 mb-4">
            
            <!-- Phase I: Initial Setup Button Dropdown -->
            <div class="relative">
                <button id="initialSetupDropdownBtn" class="dropdown-btn flex items-center justify-center">
                    Initial Setup
                    <!-- Down arrow icon -->
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="initialSetupMenu" class="absolute hidden top-full mt-2 w-56 bg-gray-800 rounded-lg shadow-2xl z-10 border border-emerald-500 p-2">
                    <!-- Sub-menu buttons will be inserted here by JS -->
                </div>
            </div>

            <!-- Phase II: Analysis Button Dropdown -->
            <div class="relative">
                <button id="analysisDropdownBtn" class="dropdown-btn flex items-center justify-center">
                    Analysis 
                    <!-- Down arrow icon -->
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="analysisMenu" class="absolute hidden top-full mt-2 w-56 bg-gray-800 rounded-lg shadow-2xl z-10 border border-emerald-500 p-2">
                    <!-- Sub-menu buttons will be inserted here by JS -->
                </div>
            </div>

            <!-- Phase III: Solution Design Button Dropdown -->
            <div class="relative">
                <button id="solutionDesignDropdownBtn" class="dropdown-btn flex items-center justify-center">
                    Solution Design
                    <!-- Down arrow icon -->
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="solutionDesignMenu" class="absolute hidden top-full mt-2 w-56 bg-gray-800 rounded-lg shadow-2xl z-10 border border-emerald-500 p-2">
                    <!-- Sub-menu buttons will be inserted here by JS -->
                </div>
            </div>

            <!-- Phase IV: Execution Button Dropdown -->
            <div class="relative">
                <button id="executionDropdownBtn" class="dropdown-btn flex items-center justify-center">
                    Execution
                    <!-- Down arrow icon -->
                    <svg class="w-4 h-4 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="executionMenu" class="absolute hidden top-full mt-2 w-56 bg-gray-800 rounded-lg shadow-2xl z-10 border border-emerald-500 p-2">
                    <!-- Sub-menu buttons will be inserted here by JS -->
                </div>
            </div>

        </div>
        
        <!-- Clear Chat button -->
        <div class="mb-4 text-right">
            <button id="clearChatBtn" class="px-4 py-2 text-sm bg-red-200 text-red-700 rounded-lg shadow-md hover:bg-red-300">Clear Chat</button>
        </div>
        
        <!-- Chat Area -->
        <div id="chatArea" class="space-y-4 max-h-96 overflow-y-auto mb-6">
            <!-- Initial welcome message -->
            <div class="flex justify-start">
                <div class="bg-emerald-100 text-emerald-700 rounded-xl p-3 max-w-sm shadow-md">
                    Hi there! I'm Bob. How can I assist you today?
                </div>
            </div>
        </div>
        
        <!-- Input and Button -->
        <div class="flex items-center space-x-2">
            <!-- TEXTAREA for multi-line input -->
            <textarea id="userInput" placeholder="Ask a question... (Enter to Send, Shift + Enter for Newline)" rows="1" class="flex-grow px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500 bg-gray-700 text-white resize-none overflow-y-hidden"></textarea>
            <button id="sendButton" class="px-6 py-2 bg-emerald-600 text-white font-semibold rounded-lg shadow-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 disabled:bg-emerald-300 disabled:cursor-not-allowed" >Send</button>
        </div>
    </div>
    
    <script>
        (function() {
            const apiKeyInput = document.getElementById('apiKeyInput');
            const saveKeyButton = document.getElementById('saveKeyButton'); // NEW
            const apiKeyContainer = document.getElementById('apiKeyContainer'); // NEW
            const sendButton = document.getElementById('sendButton');
            const userInput = document.getElementById('userInput');
            const chatArea = document.getElementById('chatArea');
            const clearChatBtn = document.getElementById('clearChatBtn');
            // DROPDOWN ELEMENTS
            const initialSetupDropdownBtn = document.getElementById('initialSetupDropdownBtn');
            const initialSetupMenu = document.getElementById('initialSetupMenu');
            const analysisDropdownBtn = document.getElementById('analysisDropdownBtn');
            const analysisMenu = document.getElementById('analysisMenu');
            const solutionDesignDropdownBtn = document.getElementById('solutionDesignDropdownBtn');
            const solutionDesignMenu = document.getElementById('solutionDesignMenu');
            const executionDropdownBtn = document.getElementById('executionDropdownBtn');
            const executionMenu = document.getElementById('executionMenu');
            let MIN_HEIGHT = 0; // Calculated minimum height (1 line)
            
            // --- PROMPT DEFINITIONS ---
            const PROMPT_MAP = {
                // Initial Setup (Phase I)
                'Industry Trends Snapshot': `Generate a **rapid, high-level Industry Trends Snapshot** for [input SPECIFIED INDUSTRY]. 

The output MUST strictly follow this high-readability structure:

# [Industry] Trends Snapshot
[concise, clear introductory explanation]

## Key Trend 1: [Trend Name]
* [concise, clear bullet point 1]
* [concise, clear bullet point 2]
* [concise, clear bullet point 3]

## Key Trend 2: [Trend Name]
* [concise, clear bullet point 1]
* [concise, clear bullet point 2]
* [concise, clear bullet point 3]
... (3 to 5 trends total)

## Summary Table
| Trend | Primary Impact |
|---|---|
| [Trend 1 Name] | * [Impact bullet 1] <br> * [Impact bullet 2] |
| [Trend 2 Name] | * [Impact bullet 1] <br> * [Impact bullet 2] |
| [Trend 3 Name] | * [Impact bullet 1] <br> * [Impact bullet 2] |

The table must be the last element of the response before the suggestions block.`,
              
                'Initial Project Charter Draft': `Generate an Initial Project Charter Draft for [input SPECIFIC PROJECT TYPE, e.g., 'implementing a new cloud-based CRM system for the sales department']. 

The output MUST strictly follow this professional structure:

# Project Charter: [Project Title]
[Short introductory summary of the project goal]

## Project Details
| Field | Value |
|---|---|
| Project Sponsor | [Placeholder Name/Title] |
| Project Manager | [Placeholder Name/Title] |
| Target Completion | [Date/Quarter] |

## Scope Overview
[1-2 paragraphs defining what is included (in scope) and what is explicitly excluded (out of scope).]

## Key Objectives
* [Measurable objective 1 (SMART)]
* [Measurable objective 2 (SMART)]
* [Measurable objective 3 (SMART)]

## Success Metrics (Key Performance Indicators)
* [Metric 1: Definition of success]
* [Metric 2: Definition of success]
* [Metric 3: Definition of success]

## High-Level Timeline (Phases)
* Phase 1: Initiation and Planning ([Duration])
* Phase 2: Execution and Development ([Duration])
* Phase 3: Deployment and Stabilization ([Duration])

The timeline must be the last element of the response before the suggestions block.`,
              
                'Problem Statement Draft': `Draft a Preliminary Problem Statement for [input SPECIFIC ISSUE, e.g., 'Customer retention has dropped by 10% in the last quarter']. 

The output MUST strictly follow the Current State, Desired State, Impact structure using Markdown headings and paragraphs:

# Preliminary Problem Statement
[A single introductory sentence about why this problem is critical.]

## 1. Current State (The Symptom)
[A concise paragraph describing the current measurable negative business symptom, its magnitude, and where it is occurring.]

## 2. Desired State (The Goal)
[A concise paragraph describing the measurable target outcome and the benefit of achieving it.]

## 3. Impact of Solving (The Value)
[A concise paragraph describing the strategic or financial value derived by the business upon successful achievement of the desired state.]

The "Impact of Solving" section must be the last element of the response before the suggestions block.`,
              
                // Analysis (Phase II)
                'Market Analysis': `Conduct a market analysis for [input SPECIFIC MARKET / INDUSTRY]. Focus on key trends, the competitive landscape, and the future outlook. 

The output MUST strictly follow this high-readability structure:

# [Analysis Title]
[concise, clear introductory explanation]

## Key Trends
* [concise, clear bullet point 1]
* [concise, clear bullet point 2]
...

## Competitive Landscape
| Competitor | Market Share/Focus | Key Strengths/Weaknesses |
|---|---|---|
| [Name 1] | [Focus] | * [Strength 1] <br> * [Weakness 1] |
| [Name 2] | [Focus] | * [Strength 1] <br> * [Weakness 1] |

## Future Outlook
* [concise, clear bullet point 1]
* [concise, clear bullet point 2]
...

The table must be the last element before the suggestions block.`,
              
                'SWOT Analysis': `Perform a SWOT analysis for [input SPECIFIC COMPANY / PROJECT]. The analysis should be grounded in recent information.

The output MUST strictly follow this structure:

# SWOT Analysis for [Company/Project]
[A concise paragraph explaining the current situation and objective.]

## Analysis Matrix
| Strengths | Weaknesses | Opportunities | Threats |
|---|---|---|---|
| * [Bullet point 1] <br> * [Bullet point 2] | * [Bullet point 1] <br> * [Bullet point 2] | * [Bullet point 1] <br> * [Bullet point 2] | * [Bullet point 1] <br> * [Bullet point 2] |
| * [Bullet point 3] | * [Bullet point 3] | * [Bullet point 3] | * [Bullet point 3] |

The table must be the last element of the response before the suggestions block.`,
              
                'Competitor Benchmarking': `Perform a detailed competitive analysis for [input COMPANY A] against [input COMPETITOR B] and [input COMPETITOR C]. Focus on their market share, product features, pricing models, and online presence. 

The output MUST strictly follow this structure:

# Competitor Benchmarking Report
[A brief introduction defining the competitive scope.]

## Benchmarking Table
| Competitor | Market Share/Focus | Product Features | Pricing Model | Online Presence |
|---|---|---|---|---|
| **[Competitor B]** | [Share/Focus] | * [Feature 1] <br> * [Feature 2] | [Model description] | [Score/Metric] |
| **[Competitor C]** | [Share/Focus] | * [Feature 1] <br> * [Feature 2] | [Model description] | [Score/Metric] |

The table must be the last element of the response before the suggestions block.`,
              
                '5 Forces Analysis': `Conduct a 5 Forces Analysis for [input SPECIFIC INDUSTRY]. Analyze the threat of new entrants, the bargaining power of buyers, the bargaining power of suppliers, the threat of substitute products, and competitive rivalry.

The output MUST strictly follow this structure:

# Porter's Five Forces Analysis: [Industry]
[A concise introductory paragraph about the industry's profitability outlook.]

## Industry Structure Summary
| Force | Threat Level (High/Medium/Low) | Key Drivers/Evidence |
|---|---|---|
| **Threat of New Entrants** | [Level] | * [Driver 1] <br> * [Driver 2] |
| **Bargaining Power of Buyers** | [Level] | * [Driver 1] <br> * [Driver 2] |
| **Bargaining Power of Suppliers** | [Level] | * [Driver 1] <br> * [Driver 2] |
| **Threat of Substitutes** | [Level] | * [Driver 1] <br> * [Driver 2] |
| **Competitive Rivalry** | [Level] | * [Driver 1] <br> * [Driver 2] |

The table must be the last element of the response before the suggestions block.`,
              
                'PESTLE Analysis': `Perform a PESTLE analysis for [input SPECIFIC COMPANY / INDUSTRY]. Analyze the Political, Economic, Social, Technological, Legal, and Environmental factors.

The output MUST strictly follow this structure:

# PESTLE Analysis for [Company/Industry]
[A brief introduction explaining the purpose of the analysis.]

The remaining analysis MUST be presented in a specific two-column table format where the 'Key Findings' column contains bullet points separated by line breaks (<br>).

| Factor | Key Findings |
|---|---|
| **Political** | * [concise finding 1] <br> * [concise finding 2] |
| **Economic** | * [concise finding 1] <br> * [concise finding 2] |
| **Social** | * [concise finding 1] <br> * [concise finding 2] |
| **Technological** | * [concise finding 1] <br> * [concise finding 2] |
| **Legal** | * [concise finding 1] <br> * [concise finding 2] |
| **Environmental** | * [concise finding 1] <br> * [concise finding 2] |

The table must be the last element of the response before the suggestions block.`,

                'Hofstede Analysis': `Perform a Hofstede's Cultural Dimensions analysis for [input SPECIFIC COUNTRY/CULTURE] focusing on its implications for [input SPECIFIC BUSINESS SCENARIO, e.g., 'market entry strategy' or 'managing a remote team']. 
                
The output MUST strictly follow this structure:

# Hofstede's Cultural Analysis: [Country]
[A concise introductory paragraph explaining the purpose of the analysis.]

## Cultural Dimensions Summary
| Dimension | Score/Rating | Business Implication |
|---|---|---|
| **Power Distance (PDI)** | [Score/Rating] | * [Implication 1] <br> * [Implication 2] |
| **Individualism vs. Collectivism (IDV)** | [Score/Rating] | * [Implication 1] <br> * [Implication 2] |
| **Masculinity vs. Femininity (MAS)** | [Score/Rating] | * [Implication 1] <br> * [Implication 2] |
| **Uncertainty Avoidance (UAI)** | [Score/Rating] | * [Implication 1] <br> * [Implication 2] |
| **Long-Term vs. Short-Term Orientation (LTO)** | [Score/Rating] | * [Implication 1] <br> * [Implication 2] |
| **Indulgence vs. Restraint (IVR)** | [Score/Rating] | * [Implication 1] <br> * [Implication 2] |

The table must be the last element of the response before the suggestions block.`,
                
                // Solution Design (Phase III)
                'Business Plan Outline': `Draft a comprehensive business plan outline for a [input YOUR BUSINESS IDEA]. 

The output MUST strictly follow this structure:

# Business Plan Outline: [Your Business Idea]
[A concise introductory summary paragraph.]

## Executive Summary
* [Core Concept]
* [Target Market]
* [Financial Highlights]

## Company Description
* [Mission Statement]
* [Legal Structure]
* [Key Personnel]

## Market Analysis
* [Industry Trends]
* [Competitive Advantage]
* [Market Size]

## Organization and Management
* [Organizational Structure]
* [Key Management Team Roles]

## Service or Product Line
* [Product/Service Description]
* [Development Status]
* [Intellectual Property]

## Marketing and Sales Strategy
* [Marketing Channels]
* [Sales Strategy]
* [Key Partnerships]

## Financial Projections
* [Startup Costs Summary]
* [3-Year Revenue Forecast Highlight]
* [Funding Request]

## Appendix
* [Supporting Documents]

The Appendix section must be the last element of the response before the suggestions block.`,
              
                'Market Entry Strategy': `Develop a comprehensive market entry strategy for [input PRODUCT / SERVICE] entering the [input SPECIFIC COUNTRY / MARKET]. 

The output MUST strictly follow this structure:

# Market Entry Strategy: [Product] in [Market]
[A brief paragraph summarizing the primary recommendation.]

## Target Audience
* [Demographics]
* [Key Needs/Pain Points]

## Distribution Strategy
* [Primary Channel]
* [Logistics and Fulfillment]

## Pricing Model
* [Recommended Strategy (e.g., Penetration, Skimming)]
* [Key Cost Drivers]

## Market Entry Options Summary
| Method | Key Advantages | Key Disadvantages |
|---|---|---|
| [Method 1] | * [Advantage 1] <br> * [Advantage 2] | * [Disadvantage 1] <br> * [Disadvantage 2] |
| [Method 2] | * [Advantage 1] <br> * [Advantage 2] | * [Disadvantage 1] <br> * [Disadvantage 2] |
| [Method 3] | * [Advantage 1] <br> * [Advantage 2] | * [Disadvantage 1] <br> * [Disadvantage 2] |

The table must be the last element of the response before the suggestions block.`,

                'Go-to-market Strategy': `Develop a comprehensive Go-to-Market (GTM) Strategy for [input PRODUCT / SERVICE (e.g. a new B2B SaaS platform)] targeting [input SPECIFIC AUDIENCE / GEOGRAPHY (e.g. mid-market financial services)]. Focus on key messaging, channel strategy, and launch metrics.

The output MUST strictly follow this structure:

# Go-to-Market Strategy: [Product]
[A brief introductory paragraph summarizing the strategic approach and main goal.]

## Target Customer Profile (ICP)
* [Target Demographic/Firmographic]
* [Primary Pain Point Addressed]
* [Unique Value Proposition (UVP)]

## Channel and Tactics Plan
| Channel Category | Key Tactics/Activities | Owner/Timeline |
|---|---|---|
| **Marketing** | * [Tactic 1 (e.g., Content)] <br> * [Tactic 2 (e.g., SEO)] | [Owner/Timeline] |
| **Sales** | * [Tactic 1 (e.g., Outbound)] <br> * [Tactic 2 (e.g., Partnerships)] | [Owner/Timeline] |
| **Product/Success** | * [Tactic 1 (e.g., Onboarding)] <br> * [Tactic 2 (e.g., Documentation)] | [Owner/Timeline] |

## Pricing & Packaging
* [Recommended Pricing Model]
* [Launch Offer / Incentive]

## Launch Metrics (KPIs)
* [Metric 1: Definition of success]
* [Metric 2: Definition of success]
* [Metric 3: Definition of success]

The "Launch Metrics" section must be the last element of the response before the suggestions block.`,

                'Ansoff Matrix': `Apply the Ansoff Matrix (Product/Market Expansion Grid) to recommend growth strategies for [input COMPANY NAME / PRODUCT IDEA ]. Analyze Market Penetration, Product Development, Market Development, and Diversification.

The output MUST strictly follow this structure:

# Ansoff Matrix Growth Recommendations
[A concise introduction defining the company's current core product and market.]

## Growth Strategy Matrix
| Strategy | Product/Market Status | Key Action/Risk |
|---|---|---|
| **Market Penetration** | Existing Product / Existing Market | * [Action 1] <br> * [Action 2] |
| **Product Development** | New Product / Existing Market | * [Action 1] <br> * [Action 2] |
| **Market Development** | Existing Product / New Market | * [Action 1] <br> * [Action 2] |
| **Diversification** | New Product / New Market | * [Action 1] <br> * [Action 2] |

The table must be the last element of the response before the suggestions block.`,
              
                'Risk Analysis': `Conduct a risk analysis for [input SPECIFIC BUSINESS VENTURE / PROJECT]. Identify potential risks, assess their likelihood and impact, and propose mitigation strategies. 

The output MUST strictly follow this structure:

# High-Level Risk Analysis: [Venture/Project Name]
[A brief introductory statement on the scope of the risk assessment.]

## Risk Mitigation Table
| Risk Area | Likelihood (H/M/L) | Impact (H/M/L) | Mitigation Strategy |
|---|---|---|---|
| **[Risk Category 1]** | [Level] | [Level] | * [Strategy 1] <br> * [Strategy 2] |
| **[Risk Category 2]** | [Level] | [Level] | * [Strategy 1] <br> * [Strategy 2] |
| **[Risk Category 3]** | [Level] | [Level] | * [Strategy 1] <br> * [Strategy 2] |

The table must be the last element of the response before the suggestions block.`,
              
                // Execution (Phase IV)
                'KPI Dashboard Mockup': `Design a **KPI Dashboard Mockup** structure for tracking the success of [input SPECIFIC BUSINESS GOAL / PROJECT, e.g., 'reducing customer churn' or 'launching a new product feature']. Define a minimum of five mandatory KPIs (Key Performance Indicators).

The output MUST strictly follow this structure:

# Key Performance Indicator (KPI) Dashboard Mockup
[A concise statement defining the overall goal of the dashboard.]

## Defined Metrics
| KPI Name | Definition/Formula | Target Value | Reporting Frequency |
|---|---|---|---|
| **[KPI 1: Financial]** | [Formula] | [Target #] | [Daily/Weekly/Monthly] |
| **[KPI 2: Customer/User]** | [Formula] | [Target #] | [Daily/Weekly/Monthly] |
| **[KPI 3: Operational]** | [Formula] | [Target #] | [Daily/Weekly/Monthly] |
| **[KPI 4: Quality]** | [Formula] | [Target #] | [Daily/Weekly/Monthly] |
| **[KPI 5: Strategic]** | [Formula] | [Target #] | [Daily/Weekly/Monthly] |

The table must be the last element of the response before the suggestions block.`,
              
                'Implementation Plan Outline': `Generate a high-level **Implementation Plan Outline** for [input PROJECT / STRATEGY, e.g., 'launching a new corporate training program']. Structure the plan into clear phases.

The output MUST strictly follow this structure:

# High-Level Implementation Plan: [Project Title]
[A brief introductory paragraph summarizing the plan's execution approach.]

## Implementation Phases
| Phase | Key Milestones | Required Resources | Estimated Duration |
|---|---|---|---|
| **Phase 1: Setup** | * [Milestone 1] <br> * [Milestone 2] | [Team/Budget/Tools] | [Duration] |
| **Phase 2: Development** | * [Milestone 1] <br> * [Milestone 2] | [Team/Budget/Tools] | [Duration] |
| **Phase 3: Deployment** | * [Milestone 1] <br> * [Milestone 2] | [Team/Budget/Tools] | [Duration] |
| **Phase 4: Stabilization** | * [Milestone 1] <br> * [Milestone 2] | [Team/Budget/Tools] | [Duration] |

The table must be the last element of the response before the suggestions block.`,
              
            };
            // Focused Button Lists
            const INITIAL_SETUP_BUTTONS = ['Industry Trends Snapshot', 'Initial Project Charter Draft', 'Problem Statement Draft'];
            const ANALYSIS_BUTTONS = ['Market Analysis', 'SWOT Analysis', 'Competitor Benchmarking', '5 Forces Analysis', 'PESTLE Analysis', 'Hofstede Analysis'];
            const SOLUTION_DESIGN_BUTTONS = ['Business Plan Outline', 'Market Entry Strategy', 'Go-to-market Strategy', 'Ansoff Matrix', 'Risk Analysis'];
            const EXECUTION_BUTTONS = ['KPI Dashboard Mockup', 'Implementation Plan Outline'];
            // This array will hold the conversation history
            const chatHistory = [{
                role: "model",
                parts: [{ text: "Hi there! I'm Bob. How can I assist you today?" }]
            }];

            // NEW FUNCTION: Saves the key to localStorage and hides the input container
            function saveAndHideKey(key) {
                if (key) {
                    localStorage.setItem('geminiApiKey', key);
                    if (apiKeyContainer) { // Safety check
                        apiKeyContainer.classList.add('hidden'); // HIDE THE CONTAINER
                    }
                } else {
                    if (apiKeyContainer) { // Safety check
                        apiKeyContainer.classList.remove('hidden');
                    }
                }
            }

            let MIN_HEIGHT = 0; // Calculated minimum height (1 line)
            
            // Function to handle dynamic textarea resizing with min/max height cap
            function autoResizeTextarea(textarea) {
                const MAX_LINES = 4;
                const computed = window.getComputedStyle(textarea);
                const lineHeight = parseFloat(computed.lineHeight);
                
                // Calculate max height based on MIN_HEIGHT (1 line) + 3 extra lines
                const maxHeight = MIN_HEIGHT + (lineHeight * (MAX_LINES - 1));
                // 1. Temporarily shrink to 'auto' to get the current content height
                textarea.style.height = 'auto'; 
                let newHeight = textarea.scrollHeight;
                // 2. Ensure min height is respected (when empty or content is small)
                if (newHeight < MIN_HEIGHT) {
                    newHeight = MIN_HEIGHT;
                }
                // 3. Cap the height at max height
                if (newHeight > maxHeight) {
                    newHeight = maxHeight;
                    textarea.style.overflowY = 'auto';
                } else {
                    textarea.style.overflowY = 'hidden';
                }
                
                // 4. Apply the final height
                textarea.style.height = `${newHeight}px`;
            }
            // Load the API key from local storage and set up initial state
            document.addEventListener('DOMContentLoaded', () => {
                const savedKey = localStorage.getItem('geminiApiKey');
                if (savedKey) {
                    apiKeyInput.value = savedKey;
                    saveAndHideKey(savedKey); // NEW: Hide key on load if found
                }
                populateMenus();
                
                // --- CRITICAL: Calculate MIN_HEIGHT (1 line height) after DOM is ready ---
                // Temporarily set height to auto to get the correct initial scroll height for an empty textarea
                userInput.style.height = 'auto';
                MIN_HEIGHT = userInput.scrollHeight;
                
                // Initialize the size of the textarea
                autoResizeTextarea(userInput);
            });
            // Function to generate the sub-menu buttons and attach listeners
            function populateMenus() {
                const createButton = (text, menuElement) => {
                    const button = document.createElement('button');
                    button.classList.add('sub-menu-btn');
                    button.textContent = text;
                    button.title = PROMPT_MAP[text] || text; // Use the prompt text as a tooltip
                    button.onclick = () => {
                        userInput.value = PROMPT_MAP[text];
                        // Trigger resize after populating content
                        autoResizeTextarea(userInput);
                        // Hide all menus when a selection is made
                        initialSetupMenu.classList.add('hidden');
                        analysisMenu.classList.add('hidden');
                        solutionDesignMenu.classList.add('hidden');
                        executionMenu.classList.add('hidden');
                        // Focus on the input field
                        userInput.focus();
                    };
                    menuElement.appendChild(button);
                };
                // Populate Menus
                initialSetupMenu.innerHTML = '';
                INITIAL_SETUP_BUTTONS.forEach(btnText => createButton(btnText, initialSetupMenu));
                analysisMenu.innerHTML = '';
                ANALYSIS_BUTTONS.forEach(btnText => createButton(btnText, analysisMenu));
                solutionDesignMenu.innerHTML = '';
                SOLUTION_DESIGN_BUTTONS.forEach(btnText => createButton(btnText, solutionDesignMenu));
                executionMenu.innerHTML = '';
                EXECUTION_BUTTONS.forEach(btnText => createButton(btnText, executionMenu));
            }
            
            // Function to create and append a message bubble
            function createMessageBubble(text, sender) {
                const messageContainer = document.createElement('div');
                messageContainer.classList.add('flex', sender === 'user' ? 'justify-end' : 'justify-start');
                
                const messageBubble = document.createElement('div');
                messageBubble.classList.add(
                    'rounded-xl',
                    'p-3',
                    'max-w-sm',
                    'shadow-md',
                    sender === 'user' ? 'bg-emerald-600' : 'bg-gray-700', 
                    sender === 'user' ? 'text-white' : 'text-gray-100', 
                    sender === 'user' ? 'rounded-br-none' : 'rounded-bl-none'
                );
                
                const suggestionsMarker = '---SUGGESTIONS---';
                let mainText = text;
                let suggestions = [];
                
                if (sender === 'model' && text.includes(suggestionsMarker)) {
                    const parts = text.split(suggestionsMarker);
                    mainText = parts[0];
                    suggestions = parts[1].split('|').map(s => s.trim());
                }
                
                if (sender === 'model') {
                    const contentDiv = document.createElement('div');
                    contentDiv.classList.add('ai-response-content');
                    const htmlContent = marked.parse(mainText);
                    contentDiv.innerHTML = htmlContent;
                    messageBubble.appendChild(contentDiv);
                } else {
                    messageBubble.textContent = mainText;
                }
                
                messageContainer.appendChild(messageBubble);
                chatArea.appendChild(messageContainer);
                
                // Add suggestion buttons if they exist
                if (suggestions.length > 0) {
                    const suggestionsContainer = document.createElement('div');
                    suggestionsContainer.classList.add('flex', 'flex-wrap', 'gap-2', 'mt-2', 'justify-start');
                    
                    suggestions.forEach(suggestion => {
                        if (suggestion) { 
                            const suggestionButton = document.createElement('button');
                            suggestionButton.classList.add('bg-gray-200', 'hover:bg-gray-300', 'text-gray-700', 'rounded-full', 'px-3', 'py-1', 'text-sm', 'shadow-md');
                            suggestionButton.textContent = suggestion;
                            suggestionButton.onclick = () => {
                                userInput.value = suggestion;
                                autoResizeTextarea(userInput);
                            };
                            suggestionsContainer.appendChild(suggestionButton);
                        }
                    });
                    chatArea.appendChild(suggestionsContainer);
                }
                
                chatArea.scrollTop = chatArea.scrollHeight; // Scroll to bottom
            }
            
            // Function to handle sending the message
            async function sendMessage() {
                const prompt = userInput.value.trim();
                const apiKey = apiKeyInput.value.trim();
                
                if (!prompt) {
                    return;
                }
                
                if (!apiKey) {
                    createMessageBubble("Please enter your Gemini API key to proceed.", "assistant");
                    return;
                }
                
                // Save the API key to local storage
                localStorage.setItem('geminiApiKey', apiKey);
                
                // Add user message to chat history and display it
                chatHistory.push({
                    role: "user",
                    parts: [{ text: prompt }]
                });
                createMessageBubble(prompt, "user");
                userInput.value = ''; // Clear input
                autoResizeTextarea(userInput); // Reset textarea height
                // Disable input and send button
                userInput.disabled = true;
                sendButton.disabled = true;
                
                // Add a loading indicator
                const loadingBubble = document.createElement('div');
                loadingBubble.classList.add('flex', 'justify-start');
                
                loadingBubble.innerHTML = `
                    <div class="bg-gray-700 text-gray-300 rounded-xl rounded-bl-none p-3 max-w-sm shadow-md">
                        <div class="flex items-center">
                            <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                            </svg>
                            Thinking...
                        </div>
                    </div>
                `;
                chatArea.appendChild(loadingBubble);
                chatArea.scrollTop = chatArea.scrollHeight;
                
                // Exponential backoff retry logic
                const MAX_RETRIES = 3;
                let retryCount = 0;
                while (retryCount < MAX_RETRIES) {
                    try {
                        const apiKey = apiKeyInput.value.trim();
                        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                        
                        const payload = {
                            systemInstruction: {
                                parts: [{ text: `You are a professional business consultant named Bob. Your role is to provide clear, actionable, and well-structured responses to business-related queries. Be concise and to the point while providing high-quality analysis. Use Markdown to format your output. A typical response should follow this structure: a main title (#), followed by a short summary or introduction, then several distinct sections. Each section should begin with a **subheading (##)**, followed by a short descriptive sentence. For subsections within a section, use a level three heading (###). For individual points within a list, use a bolded phrase followed by a bulleted list.For structured analyses (like SWOT, Market Entry, or Competitor Benchmarking), you must create a relevant, professional-grade Markdown table that is appropriate for the requested analysis.ONLY when generating a PESTLE analysis, you MUST use the following specific Markdown format, ensuring the "Key Findings" column uses bullet points with spacing:\`\`\`markdown| Factor | Key Findings ||---|---|| Political | * [concise finding 1] <br> * [concise finding 2] || Economic | * [concise finding 1] <br> * [concise finding 2] || Social | * [concise finding 1] <br> * [concise finding 2] || Technological | * [concise finding 1] <br> * [concise finding 2] || Legal | * [concise finding 1] <br> * [concise finding 2] || Environmental | * [concise finding 1] <br> * [concise finding 2] |\`\`\`The table must be the last piece of content before the suggestions. Ensure clarity and professionalism by using Markdown for titles, subheadings, bold text, bullet points, and the summary table. The content must be grounded in real-time information. You must use the Google Search tool for every query to get the most accurate and up-to-date data. At the end of every response, suggest 2-3 short, relevant follow-up questions. Format these suggestions as a single line, separated by a pipe symbol, and preceded by the text \`---SUGGESTIONS---\`. For example: \`---SUGGESTIONS---What is a PESTLE analysis?|How can I improve my marketing plan?|What is a market entry strategy?\`` }]
                            },
                            contents: chatHistory,
                            tools: [{ "google_search": {} }],
                        };
                        
                        const response = await fetch(apiUrl, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(payload)
                        });
                        
                        if (response.status === 429) { // Handle rate limiting
                            if (retryCount < MAX_RETRIES - 1) {
                                retryCount++;
                                const delay = Math.pow(2, retryCount) * 1000; // Exponential backoff (2s, 4s, 8s)
                                await new Promise(resolve => setTimeout(resolve, delay));
                                continue; // Retry the loop
                            } else {
                                throw new Error("Rate limit exceeded after multiple retries.");
                            }
                        }
                        if (!response.ok) {
                            const errorText = await response.text();
                            throw new Error(`API call failed with status ${response.status}: ${errorText}`);
                        }
                        
                        const result = await response.json();
                        const text = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                        
                        // Remove loading indicator
                        chatArea.removeChild(loadingBubble);
                        
                        if (text) {
                            // Add the assistant's response to the chat history and display it
                            chatHistory.push({
                                role: "model",
                                parts: [{ text: text }]
                            });
                            createMessageBubble(text, "model");
                        } else {
                            createMessageBubble("Sorry, I couldn't generate a response. Please try again.", "assistant");
                        }
                        break; // Exit the retry loop on success
                    } catch (error) {
                        console.error("API Error:", error);
                        if (retryCount >= MAX_RETRIES - 1) {
                            // Remove loading indicator and show error
                            if (chatArea.contains(loadingBubble)) {
                                chatArea.removeChild(loadingBubble);
                            }
                            createMessageBubble(`An error occurred: ${error.message}`, "assistant");
                            break; // Exit the loop if max retries reached
                        }
                        retryCount++;
                        const delay = Math.pow(2, retryCount) * 1000; // Exponential backoff
                        await new Promise(resolve => setTimeout(resolve, delay));
                    }
                }
                
                // Re-enable input and send button
                userInput.disabled = false;
                sendButton.disabled = false;
                userInput.focus();
            }

            // NEW: Listener for the Save Key button
            saveKeyButton.addEventListener('click', () => {
                const key = apiKeyInput.value.trim();
                if (key) {
                    saveAndHideKey(key);
                }
            });
            
            // Event listener for button click
            sendButton.addEventListener('click', sendMessage);
            // Event listener for input/typing to automatically resize the textarea
            userInput.addEventListener('input', () => autoResizeTextarea(userInput));
            
            // Event listener for keyboard input: Enter sends, Shift+Enter adds newline.
            userInput.addEventListener('keydown', (event) => {
                // If Enter is pressed AND Shift is NOT pressed, send the message.
                if (event.key === 'Enter' && !event.shiftKey) {
                    event.preventDefault(); // Stop the default (newline) action
                    sendMessage();
                }
                // If Shift + Enter is pressed, the default action (newline) is permitted, and the 'input' event will handle the resize.
            });
            
            // New event listener for the "Clear Chat" button
            clearChatBtn.addEventListener('click', () => {
                chatArea.innerHTML = '';
                
                chatHistory.length = 0;
                const welcomeMessage = "Hi there! I'm Bob. How can I assist you today?";
                chatHistory.push({
                    role: "model",
                    parts: [{ text: welcomeMessage }]
                });
                createMessageBubble(welcomeMessage, "assistant");
                userInput.placeholder = "Ask a question... (Enter to Send, Shift + Enter for Newline)";
                autoResizeTextarea(userInput); // Reset height on clear
            });
            // --- DROPDOWN TOGGLE LOGIC ---
            function toggleMenu(menuElement, buttonElement) {
                // Determine if any *other* menus are open and close them
                [initialSetupMenu, analysisMenu, solutionDesignMenu, executionMenu].forEach(menu => {
                    if (menu !== menuElement) {
                        menu.classList.add('hidden');
                    }
                });
                // Toggle the current menu
                menuElement.classList.toggle('hidden');
            }
            // Click listeners for the main dropdown buttons
            initialSetupDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                toggleMenu(initialSetupMenu, initialSetupDropdownBtn);
            });
            analysisDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                toggleMenu(analysisMenu, analysisDropdownBtn);
            });
            solutionDesignDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                toggleMenu(solutionDesignMenu, solutionDesignDropdownBtn);
            });
            executionDropdownBtn.addEventListener('click', (e) => {
                e.stopPropagation(); 
                toggleMenu(executionMenu, executionDropdownBtn);
            });
            // Listener to close menus when clicking anywhere else on the document
            document.addEventListener('click', (e) => {
                const menus = [initialSetupMenu, analysisMenu, solutionDesignMenu, executionMenu];
                
                let clickedInsideMenu = false;
                for (const menu of menus) {
                    if (menu.contains(e.target)) {
                        clickedInsideMenu = true;
                        break;
                    }
                }
                if (!clickedInsideMenu) {
                    // If the click was not inside any menu, hide all menus
                    menus.forEach(menu => menu.classList.add('hidden'));
                }
            });
        })(); // End of IIFE
    </script>
</body>
</html>
